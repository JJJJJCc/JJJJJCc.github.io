<!DOCTYPE html>
<html>
<head>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
   
    <link href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1202/assets/stylesheet.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="   crossorigin="anonymous"></script>

    <script>
      (function() {
        var cx = '003265255082301896483:sq5n7qoyfh8';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/prism.min.js"></script>
  <title>Karplus-strong String Synthesis</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel ="shortcut icon" type = "image/png" href = "img/wt.png">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link href="https://fonts.googleapis.com/css?family=Faster+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Trochut&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Trochut&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css">
<style>

body,h1,h2,h3,h4,h5,h6 {font-family: 'Lato', sans-serif;}
body, html {
    height: 100%;
    color: #303030;
    line-height: 1.8;
}
.w3-bar-item{
  font-family: 'Trochut', cursive;
  font-size: 15px;
}

/* Create a Parallax Effect */
.bgimg-1, .bgimg-2, .bgimg-3 {
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}


/* Turn off parallax scrolling for tablets and phones */
@media only screen and (max-device-width: 1024px) {
    .bgimg-1, .bgimg-2, .bgimg-3 {
        background-attachment: scroll;
    }
}

/*center the image*/
.center {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 50%;
}


/* Create a Parallax Effect */
.bgimg-1, .bgimg-2, .bgimg-3 {
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}



.w3-wide {letter-spacing: 6px;}
.w3-hover-opacity {cursor: pointer;}

</style>
<link href="jQueryAssets/jquery.ui.core.min.css" rel="stylesheet" type="text/css">
<link href="jQueryAssets/jquery.ui.theme.min.css" rel="stylesheet" type="text/css">

<body>
<header class="w3-center w3-black w3-padding-32 w3-hover-opacity">
  <!-- Navbar (sit on top) -->
<div class="w3-top">
  <div class="w3-bar" id="myNavbar">
    <a class="w3-bar-item w3-button w3-hover-black w3-hide-medium w3-hide-large w3-right" href="javascript:void(0);" onclick="toggleFunction()" title="Toggle Navigation Menu">
      <i class="fa fa-bars"></i>
    </a>
    <a href="software.html" class="w3-bar-item w3-button">Back software</a>
    </a>
  </div>
    <p></p>
</header>


  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-bar-block w3-white w3-hide w3-hide-large w3-hide-medium" >
    <a href="#about" class="w3-bar-item w3-button"  onclick="toggleFunction()">ABOUT</a>
    <a href="#mymusic" class="w3-bar-item w3-button"  onclick="toggleFunction()">MY MUSIC</a>
    <a href="projects.html" class="w3-bar-item w3-button" onclick="toggleFunction()">PROJECTS AND INTERNSHIP</a>
    <a href="#" class="w3-bar-item w3-button">SEARCH</a>
  </div>
</div>

<!-- First Parallax Image with Logo Text. -->

<div class="w3-content w3-container w3-padding-64" id="about">
<h3 class="w3-center"><b>Karplus-strong String Synthesis</b></h3>
<h4>Theory</h4>
<p>According to the Julius's Music physical modeling book <a href="https://ccrma.stanford.edu/~jos/pasp/">[1]</a>ï¼Œa very simple string model can be implemented using a single delay line and our simple first-order low pass filter \(H(z)\) to model frequency-dependent loss. Different quality string sounds can be created by changing this filter. The following Figure shows this model.<br>
<div class ="w3-center">
<img  src="img/ks.png" width="400" >
</div>
How to simulate the player plucking the string, here comes an algorithm called Karplus-Strong, where the delay-line initial conditions consist of white noise and the \(H(z) = \frac{1}{2}+\frac{1}{2}z^{-1}\). Then the transfer function of the whole system can be obtained:
  \[H(z) = \frac{Y(z)}{X(z)} = \frac{z^{-N}}{1-z^{-N}H(z)} = \frac{z^{-N}}{1-\frac{1}{2}z^{-N}-\frac{1}{2}z^{-(N+1)}}\]

<h4>MATLAB simulation</h4>
<pre><code>function y = karplus_strong(f,fs,length)
%freq = fundemental frequency of the string(in hz)
%len = duration of the resulting soundfile(in sample)
%fs = sample rate(in Hz)
%y = vector containing the output samples
  N = fix(fs/f); % the rounded N samples
  x=zeros(1,length*fs);            
  b=[zeros(1,N) 1];
  a=[1 zeros(1,N-1) -.5 -.5];
  zi = rand(1, max( max(size(a)), max(size(b))) -1);
  y=filter(b,a,x,zi); %initial condition of delay lines is white noise
end
</code></pre>
Here is the sample note scale generated by the above function:
<div class="w3-center">
<audio controls>
  <source src="audio/ks.wav" type="audio/mpeg">
</audio>
</div>
<h4>C++ Implementation</h4>
Here is C++ version of Karplus-strong stirng.<br>
<a href="code/main.cpp" download>main.cpp</a><br>
<a href="code/guitar.cpp" download>guitar.cpp</a><br>
<a href="code/guitar.h" download>guitar.h</a><br>
You can run the program by simpling build and compile:
<pre><code>g++ -Wall -o guitar main.cpp guitar.cpp
</code></pre>
<h4>Reference</h4>
</div>


<!-- Footer -->
<footer class="w3-center w3-black w3-padding-16 w3-hover-opacity" style = "font-family: 'Trochut', cursive;">
  <p>CHEN JI @2019</a></p>
</footer>

  <script src="https://web.stanford.edu/class/archive/cs/cs107/cs107.1202/assets/tocbot.min.js"></script>
  <link rel="stylesheet" href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1202/assets/tocbot.css">

  <script>
    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '#toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: '#main_for_toc',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3',
    });
  </script>
</div>
    </main>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</body>
</html>

