<!DOCTYPE html>
<html>
<head>
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
   
    <link href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1202/assets/stylesheet.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="   crossorigin="anonymous"></script>

    <script>
      (function() {
        var cx = '003265255082301896483:sq5n7qoyfh8';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/prism.min.js"></script>
  <title>CIPIC HRTF simulation</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel ="shortcut icon" type = "image/png" href = "img/wt.png">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link href="https://fonts.googleapis.com/css?family=Faster+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Trochut&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Trochut&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css">
<style>

body,h1,h2,h3,h4,h5,h6 {font-family: 'Lato', sans-serif;}
body, html {
    height: 100%;
    color: #303030;
    line-height: 1.8;
}
.w3-bar-item{
  font-family: 'Trochut', cursive;
  font-size: 15px;
}

/* Create a Parallax Effect */
.bgimg-1, .bgimg-2, .bgimg-3 {
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}


/* Turn off parallax scrolling for tablets and phones */
@media only screen and (max-device-width: 1024px) {
    .bgimg-1, .bgimg-2, .bgimg-3 {
        background-attachment: scroll;
    }
}

/*center the image*/
.center {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 50%;
}


/* Create a Parallax Effect */
.bgimg-1, .bgimg-2, .bgimg-3 {
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}



.w3-wide {letter-spacing: 6px;}
.w3-hover-opacity {cursor: pointer;}

</style>
<link href="jQueryAssets/jquery.ui.core.min.css" rel="stylesheet" type="text/css">
<link href="jQueryAssets/jquery.ui.theme.min.css" rel="stylesheet" type="text/css">

<body>
<header class="w3-center w3-black w3-padding-32 w3-hover-opacity">
  <!-- Navbar (sit on top) -->
<div class="w3-top">
  <div class="w3-bar" id="myNavbar">
    <a class="w3-bar-item w3-button w3-hover-black w3-hide-medium w3-hide-large w3-right" href="javascript:void(0);" onclick="toggleFunction()" title="Toggle Navigation Menu">
      <i class="fa fa-bars"></i>
    </a>
    <a href="software.html" class="w3-bar-item w3-button">Back software</a>
    </a>
  </div>
    <p></p>
</header>

</div>

<!-- First Parallax Image with Logo Text. -->

<div class="w3-content w3-container w3-padding-64" id="about">
<h3 class="w3-center"><b>CIPIC HRTF simulation</b></h3>
<h4>Introduction</h4>
<p>Spatial audio can be achieved by using various methods: ambisonics, Wave field synthesis (WFS) and HRTF. This project focues on the HRTF method. <a href="https://www.ece.ucdavis.edu/cipic/spatial-sound/hrtf-data/">CIPIC HRTF Database</a> will be used, which is a public-domain database of high-spatial-resolution HRTF measurements for 45 different subjects, including the KEMAR mannequin with both small and large pinnae. </p>
<h4>Theory</h4>
<p>An HRTF is a transfer function that characterizes how sound from a par-ticular point in space is received by the ear. A pair of HRTFs, one for each ear, can be used to synthesize binaural sound. HRTFs are very useful for accurate localization of sounds, especially those not coming from just the horizontal plane. HRTFs for left and right ear give the fltering of a sound source (represented here in the time domain) \(x[n]\) before it is perceived by the ears as \(xL[n]\) and \(xR[n]\), respectively. The HRTF can be found by measuring a head-related impulse response (HRIR).<br></br> In CIPIC HRTF database, “standard” measurements were recorded at 25 different interaural-polar azimuths and 50 different interaural-polar elevations. In specific, for the azimuth-level, the measure point array is [-80 -65 -55 -45:5:45 55 65 80], while the elevation-level point array is [-45:360/64:235]. The following Figure shows the measured points with head (a is for interaural-polar azimuths, b is for interaural-polar elevations).
<div class ="w3-center">
<img  src="img/hrtf.png" width="350" >
</div>
<h4>MATLAB simulation</h4>
<h5>Read data function</h5>
<pre><code>function hrtf= readCipicHrtf(subject,Ia,Ie,channel)
% This function is used to load the hrir from the database during the runtime.
% Input parameter: subject for 45 different subjects(string type,eg."003","008")
% Ia for azimuth index, Ia for elevation index
% channel for left or right channels(string type, eg.'l','r')
    
    data_path_head='./CIPIC_HRTF_LIBRARY/subject_'; % Find path to hrir data files
    data_path_tail = '/hrir_final.mat';
    Fname = data_path_head+subject+data_path_tail;
     
    load(Fname); % get the HRTF of azimuth and elevation   
    if(channel == 'l')    
        hl = hrir_l( Ia ,Ie,:);
        for i=1:200
            hrtf(i) = hl(i);
        end
    elseif(channel == 'r')
        hr = hrir_r( Ia ,Ie,:);
        for i=1:200
            hrtf(i) = hr(i);
        end
end
</code></pre>
<h5>Point sound source function</h5>
<pre><code>function pointSoundSource(azimuth, elevation, subject)
    % this function allows user to input azimuth and elvation degrees
    % as well as the hrir data.
    % Input parameters:
    % azimuth: the azimuth drgree of your sound source
    % elevation: the elevation degree of your sound drgree
    % subject: in the dataset file, you can choose file, eg."003","009" etc.
    % Output parameter:
    % Wav file/ also you can listen the sound by soundsc.

    azimuth_cipic = [-80 -65 -55 -45:5:45 55 65 80]; %azimuth(13)==0 
    azimuth_index = find(azimuth_cipic==azimuth);

    elevation_cipic = -45:360/64:235;
    elevation_index = find(elevation_cipic==elevation); 

    hrtf_l = readCipicHrtf(subject,azimuth_index,elevation_index,'l');
    hrtf_r = readCipicHrtf(subject,azimuth_index,elevation_index,'r');

    [input, fs] = audioread('es01.wav');
    binarual_l = filter(hrtf_l,1,input);
    binarual_r = filter(hrtf_r,1,input);

    binarual_output=[binarual_l binarual_r];
    soundsc(binarual_output,fs);
    audiowrite('es01_point_binarual.wav',binarual_output,fs);
end
</code></pre>
I am testing the output by call function:
<pre><code>pointSoundSource(-40, 0, "003")
</code></pre>
<div class="w3-center">
  <p>This is the input audio:</p>
<audio controls>
  <source src="audio/es01.wav" type="audio/mpeg">
</audio>
  <p>This is the output audio:</p>
<audio controls>

  <source src="audio/es01_point_binarual.wav" type="audio/mpeg">
</audio>
</div>

<h5>Sorround sound source function</h5>
<pre><code>function surroundSoundSource(subject)
% For azimuth degrees
azimuth_cipic = [-80 -65 -55 -45:5:45 55 65 80];
azimuth_index=1:25;
% For aelevation degrees
elevation_cipic=-45:360/64:235;
elevation=0;
elevation_index_at0=find(elevation_cipic==elevation);
elevation_index=elevation_index_at0*ones(1,25);
% Read input audio file
[input, fs] = audioread('es01.wav');

framenumber = 25;
framesize=floor(length(input) / framenumber);

for i=1:length(azimuth_cipic)
    hrtf_l= readCipicHrtf(subject,azimuth_index(i),elevation_index(i),'l');
    hrtf_r= readCipicHrtf(subject,azimuth_index(i),elevation_index(i),'r');
    input_temp=input((framesize*(i-1)+1):framesize*i);

    binarual_l=filter(hrtf_l,1,input_temp);
    binarual_r=filter(hrtf_r,1,input_temp);

    if i==1
         binarual_output=[binarual_l,binarual_r];
    else
        binarual_output=vertcat(binarual_output,[binarual_l,binarual_r]);
    end
end

    soundsc(binarual_output,fs);
    audiowrite('es01_surround_binarual.wav',binarual_output,fs);
end
</code></pre>
I am testing the output by call function:
<pre><code>surroundSoundSource("003")
</code></pre>
<div class="w3-center">
  <p>This is the output audio:</p>
<audio controls>
  <source src="audio/es01_surround_binarual.wav" type="audio/mpeg">
</audio>
  <p>Also tried the foot step:</p>
  <audio controls>
  <source src="audio/foot_surround_binarual.wav" type="audio/mpeg">
</audio>
</div>
<h4>JUCE plugin</h4>

<h4>Reference</h4>
<p><a href="https://www.ece.ucdavis.edu/cipic/files/2015/04/cipic_CIPIC_HRTF_Database.pdf">[1]</a> Algazi, V.R., Duda, R.O., Thompson, D.M. and Avendano, C., 2001, October. The cipic hrtf database. In Proceedings of the 2001 IEEE Workshop on the Applications of Signal Processing to Audio and Acoustics (Cat. No. 01TH8575) (pp. 99-102). IEEE.</p>
</div>


<!-- Footer -->
<footer class="w3-center w3-black w3-padding-16 w3-hover-opacity" style = "font-family: 'Trochut', cursive;">
  <p>CHEN JI @2019</a></p>
</footer>

  <script src="https://web.stanford.edu/class/archive/cs/cs107/cs107.1202/assets/tocbot.min.js"></script>
  <link rel="stylesheet" href="https://web.stanford.edu/class/archive/cs/cs107/cs107.1202/assets/tocbot.css">

  <script>
    tocbot.init({
      // Where to render the table of contents.
      tocSelector: '#toc',
      // Where to grab the headings to build the table of contents.
      contentSelector: '#main_for_toc',
      // Which headings to grab inside of the contentSelector element.
      headingSelector: 'h1, h2, h3',
    });
  </script>
</div>
    </main>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</body>
</html>

